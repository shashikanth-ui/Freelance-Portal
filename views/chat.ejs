<%- include("partials/header") %>

<div class="chat-container">
  <h2>Chat</h2>

  <div class="messages-box">
    <% if (messages.length > 0) { %>
      <% messages.forEach(msg => { %>
        <div class="message <%= msg.sender_id === user.id ? 'sent' : 'received' %>">
          <p><%= msg.message_text %></p>
          <small><%= new Date(msg.created_at).toLocaleTimeString() %></small>
        </div>
      <% }) %>
    <% } else { %>
      <p class="no-messages">No messages yet. Start the conversation!</p>
    <% } %>
  </div>

  <form action="/chat/send" method="POST" class="chat-form">
    <input type="hidden" name="receiver_id" value="<%= otherUserId %>">
    <textarea name="message" rows="2" placeholder="Type your message..." required></textarea>
    <button type="submit">Send</button>
  </form>
</div>

<style>
.chat-container { max-width: 600px; margin: auto; padding: 20px; }
.messages-box { border: 1px solid #ddd; padding: 10px; height: 400px; overflow-y: auto; margin-bottom: 15px; background: #fafafa; }
.message { margin: 8px 0; padding: 10px; border-radius: 8px; max-width: 75%; }
.message.sent { background: #d1f7c4; margin-left: auto; text-align: right; }
.message.received { background: #f1f1f1; margin-right: auto; text-align: left; }
.chat-form { display: flex; gap: 10px; }
.chat-form textarea { flex: 1; resize: none; }
.chat-form button { padding: 8px 16px; }
</style>